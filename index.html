<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>中国象棋</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>
  <div id="app">
    <h1>中国象棋</h1>

    <!-- 登录区 -->
    <div id="authBox" style="display:flex;gap:8px;align-items:center;">
      <input id="emailInput" type="email" placeholder="输入邮箱登录（魔法链接）"/>
      <button id="emailLoginBtn">发送登录链接</button>
      <button id="logoutBtn" style="display:none;">退出</button>
      <span id="whoami"></span>
    </div>

    <!-- 在线人数（来自 presence 表） -->
    <div style="margin:6px 0 12px 0;">
      在线人数：<b id="onlineCount">0</b>
      <a href="/mode.html" style="margin-left:12px;">→ 进入匹配大厅</a>
    </div>

    <!-- 你的顶部控制条 / 棋盘 / 说明 …（保留原有结构） -->
    <div class="top-bar"> … </div>
    <div id="board" role="grid" aria-label="中国象棋棋盘"></div>
    <div class="legend"> … </div>
  </div>

<script type="module" src="/js/supabase-client.js"></script>
<script type="module" src="/js/auth-and-presence.js"></script>
<script type="module" src="/js/heartbeat.js"></script>
<script type="module" src="/js/online-count.js"></script>
<script type="module" src="/js/online-game.js"></script>
<script type="module">
  import { bootFromURL } from '/js/online-game.js';
  import { startHeartbeat } from '/js/heartbeat.js';
  // 登录后在 auth-and-presence.js 已经会 startHeartbeat('lobby')
  bootFromURL(); // 有 matchId 就直接进入在线对战
</script>
<script type="module" src="/js/ui-view.js"></script>

</body>
</html>
